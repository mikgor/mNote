{% extends 'base.html' %}
{% block title %}
   Strona główna
{% endblock %}
{% block content %}
<script type="text/javascript">
   function update_handler( $id, $i ) {
    return function(event) {
        location.href = "{% url 'UpdateCheckboxNote' %}?note_id=" + $id + "&index=" + $i;
    };
}
   function processNote($type, $id) {
      if ($type != "text") {
         $elId = "#note" + $id;
         $options = $($elId + "Text").text().trim().split(";");
         $($elId + "Text").text("");
         if ($type == "todo") {
            for ($i = 0; $i < $options.length-1; $i++) {
               $checked = $options[$i].indexOf('*')>=0 ? "checked" : "";
               $($elId + "Text").append("<input type='checkbox' id='" + $id + $i + "Checkbox' " + $checked + "/> " + $options[$i].replace('*', ''));
               $("#" + $id + $i + "Checkbox").click(
                  update_handler( $id, $i ));
            }
         }
         else if ($type == "list") {
            $($elId + "Text").append("<ol id='" +$id +"Ol'></ol>");
            for ($i = 0; $i < $options.length-1; $i++) {
               $("#" + $id + "Ol").append("<li>" + $options[$i] + "</li>");
            }
         }
      }
   }
</script>
   {% if notes %}
      {% for note in notes %}
         <div class="note" id="note{{ note.id }}">
            <div class="noteTitle">
               {{ note.title }} <a href="{% url 'NoteUpdate' note.id %}">Zmień</a> <a href="{% url 'NoteDelete' note.id %}">Usuń</a>
            </div>
            <div class="noteText" id="note{{ note.id }}Text">
               {{ note.text }}
            </div>
         </div>
         <script type="text/javascript">
            processNote("{{ note.type }}","{{ note.id }}");
         </script>
      {% endfor %}
   {% else %}
      <p>Brak notatek.</p>
   {% endif %}
   {% if groups %}
   {% for group in groups %}
      <br>{{ group.id }}
      {{ group.name }} <a href="{% url 'GroupUpdate' group.id %}">Zmień</a> <a href="{% url 'GroupDelete' group.id %}">Usuń</a>
      {% for u in group.users.all %}
         {{ u }}
      {% endfor %}
      {% for note in group.notes.all %}
         <div class="note" id="note{{ note.id }}">
            <div class="noteTitle">
               {{ note.title }} <a href="{% url 'NoteUpdate' note.id %}">Zmień</a> <a href="{% url 'NoteDelete' note.id %}">Usuń</a>
            </div>
            <div class="noteText" id="note{{ note.id }}Text">
               {{ note.text }}
            </div>
         </div>
         <script type="text/javascript">
            processNote("{{ note.type }}","{{ note.id }}");
         </script>
      {% endfor %}
   {% endfor %}
   {% else %}
      <p>Brak grup.</p>
   {% endif %}
{% endblock %}
